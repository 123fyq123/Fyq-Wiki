## 概述

主要记录各种树状数组的例题

---

## 【模板】树状数组 (单点修改，区间查询)

[题目链接](https://www.luogu.com.cn/problem/P3374)

### 题目描述

如题，已知一个数列，你需要进行下面两种操作：

- 将某一个数加上 $x$

- 求出某区间每一个数的和

**输入格式**

第一行包含两个正整数 $n,m$，分别表示该数列数字的个数和操作的总个数。   
 
第二行包含 $n$ 个用空格分隔的整数，其中第 $i$ 个数字表示数列第 $i$ 项的初始值。

接下来 $m$ 行每行包含 $3$ 个整数，表示一个操作，具体如下：

- `1 x k`  含义：将第 $x$ 个数加上 $k$

- `2 x y`  含义：输出区间 $[x,y]$ 内每个数的和

**输出格式**

输出包含若干行整数，即为所有操作 $2$ 的结果。

**输入样例** 

```
5 5
1 5 4 2 3
1 1 3
2 2 5
1 3 -1
1 4 2
2 1 4
```

**输出样例**

```
14
16
```

**数据范围**

对于 $30\%$ 的数据，$1 \le n \le 8$，$1\le m \le 10$

对于 $70\%$ 的数据，$1\le n,m \le 10^4$

对于 $100\%$ 的数据，$1\le n,m \le 5\times 10^5$


**样例说明**

 ![](https://cdn.luogu.com.cn/upload/pic/2256.png) 

故输出结果14、16

### 题解

单点修改，区间查询模板题

### 代码

```c++
#include<bits/stdc++.h>

using namespace std;

int tr[500005];
int n,m;

int lowbit(int x)
{
	return x&-x;
}

void add(int x, int c)
{
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
}

int sum(int x)
{
    int res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}

int main()
{
	int k;
	cin>>m>>n;
	for(int i=1;i<=m;i++)
	{
		cin>>k;
		add(i,k);
	}
	int command,a,b;
	for(int i=1;i<=n;i++)
	{
		cin>>command>>a>>b;
		if(command==1) add(a,b);
		if(command==2) cout<<sum(b)-sum(a-1)<<endl;
	}
	return 0;
}
```

---

## 【模板】树状数组 (区间修改,单点查询)

[题目链接](https://www.luogu.com.cn/problem/P3368)

### 题目描述

如题，已知一个数列，你需要进行下面两种操作：

1. 将某区间每一个数加上 $x$；

2. 求出某一个数的值。

**输入格式**

第一行包含两个整数 $N$、$M$，分别表示该数列数字的个数和操作的总个数。

第二行包含 $N$ 个用空格分隔的整数，其中第 $i$ 个数字表示数列第 $i $ 项的初始值。

接下来 $M$ 行每行包含 $2$ 或 $4$个整数，表示一个操作，具体如下：

操作 $1$： 格式：`1 x y k` 含义：将区间 $[x,y]$ 内每个数加上 $k$；

操作 $2$： 格式：`2 x` 含义：输出第 $x$ 个数的值。

**输出格式**

输出包含若干行整数，即为所有操作 $2$ 的结果。

**输入样例** 

```
5 5
1 5 4 2 3
1 2 4 2
2 3
1 1 5 -1
1 3 5 7
2 4
```

**输出样例** 

```
6
10
```

**样例解释**

 ![](https://cdn.luogu.com.cn/upload/pic/2258.png) 

故输出结果为 6、10。

**数据规模与约定**

对于 $30\%$ 的数据：$N\le8$，$M\le10$；

对于 $70\%$ 的数据：$N\le 10000$，$M\le10000$；

对于 $100\%$ 的数据：$1 \leq N, M\le 500000$，$1 \leq x, y \leq n$，保证任意时刻序列中任意元素的绝对值都不大于 $2^{30}$。

### 题解

区间修改，单点查询模板题，维护差分数组即为区间修改，前缀和即为单点查询

若修改区间为$[l,r]$，同时加上$x$

则操作如下：

+   $add(l, x)$
+   $add(r+1, -x)$

### 代码

```c++
#include<bits/stdc++.h>
using namespace std;

const int N=5e5+5;

int a[N],cha[N],tr[N];
int n,m;

int lowbit(int x){return x&-x;}

void add(int x, int c)
{
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
}

void update(int l,int r,int x)
{
    add(l,x);
    add(r+1,-x);
}

int sum(int x)
{
    int res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}

int main()
{
    cin>>n>>m;
    for(int i=1;i<=n;i++)
    {
        cin>>a[i];
        add(i,a[i]-a[i-1]); // 维护的是差分数组
    }
    int op,a,b,c;
    for(int i=1;i<=m;i++)
    {
        cin>>op;
        if(op==1)
        {
            cin>>a>>b>>c;
            update(a,b,c);
        }
        else
        {
            cin>>a;
            cout<<sum(a)<<endl;
        }
    }
    return 0;
}
```

---

